var mydata;
var mycolors;
var mylabels;

var mybackgroundColors = ['#F7931A', '#1E88E5', '#FC4B6C', '#FAC364', '#5b5da8', '#4BC0C0', '#ff99e6', '#ffff99', '#ff0000', '#40ff00'];

function getColoursArray(count) {
    var newcolors = [];
    for (var i = 0; i < count; i++) {
        newcolors.push(mybackgroundColors[i % mybackgroundColors.length]);
    }
    return newcolors
};

function SetupPieChart() {
    Chart.defaults.global.defaultFontFamily = 'Poppins, sans-serif', Chart.defaults.global.defaultFontColor = "#292b2c";

    var config = {
        type: 'doughnut',
        data: {
            datasets: [{
                data: mydata,
                backgroundColor: mycolors,
                borderColor: [
                    'rgba(255,255,255,0.5)'
                ],
                borderWidth: 1,
                label: 'PayCloud pie chart'
            }],
            labels: mylabels
        },
        options: {
            responsive: true,
            legend: {
                display: true,
                position: "bottom",
            },
            title: {
                display: false,
                text: 'Chart.js Doughnut Chart'
            },
            pieceLabel: {
                render: 'percentage',
                //fontColor: ['#F7931A', '#1E88E5', '#FC4B6C', '#FAC364', '#5b5da8', '#4BC0C0'],
                fontSize: 16,
                fontStyle: 'bold',
                position: 'outside',
                precision: 2
            },
            animation: {
                animateScale: true,
                animateRotate: true
            }
        }
    };
    return config;
}
window.onload = function () {
    getChartData();

};

function getChartData(update) {
    $.ajax({
        url: '/user/accounts/GetPieChartInfo',
        type: 'GET',
        cache: false,
        dataType: 'json',
        success: function (data) {
            console.log(data);
            mydata = data.map(x => x.balance);
            console.log(mydata)
            mylabels = data.map(x => x.accountNickname);
            console.log(mylabels);
            mycolors = getColoursArray(data.length);
            if (update) {
                console.log("update-----")
                myPie.data.datasets[0] = {
                    data: mydata,
                    backgroundColor: mycolors,
                    borderColor: ['rgba(255,255,255,0.5)'],
                    borderWidth: 1,
                    label: 'PayCloud pie chart'
                };

                myPie.data.labels = mylabels;
                myPie.options.animation.animateRotate = false;
                myPie.options.animation.animateScale = false;

                myPie.update();
            }
            else {

                var ctx = document.getElementById('myPieChart').getContext('2d');
                window.myPie = new Chart(ctx, SetupPieChart());
            }


        }
    });
};
